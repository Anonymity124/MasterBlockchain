POS共识机制
==========

- [1. POS原理](#1-pos原理)
- [2. 应用POS的几个区块链](#2-应用pos的几个区块链)
    - [2.1. 点点币(Peercoin)](#21-点点币peercoin)
    - [2.2. 未来币(NXT)](#22-未来币nxt)
- [3. POS的问题](#3-pos的问题)
- [4. POS的解决方式](#4-pos的解决方式)
- [5. 总结](#5-总结)
- [6. 参考资料](#6-参考资料)

Proof of Stake（权益证明，以下简称POS），是与POW类似的一种经典的区块链共识机制。不过，POS不需要节点进行数学运算进行挖矿过程。因此，POS相对于POW来说，不需要消耗大量的能源，这是它的一个主要的优势。POS中，节点获取记账权的方式也是不太一样的，并非简单的按照币龄来决定。

## 1. POS原理

POW挖矿竞争的本质就是几个记账节点比拼实力，向全网证明自己拥有的资源多。而POS则要文雅的多，只要证明自己有这个实力就行了，不必真的浪费人力物力去做一些毫无意义的数学计算。这就如同几个国家打仗，POW是几个国家用真金白银购买真刀真枪然后干，后果就是所有的国家都要付出血的代价。这个时候就有人提出了，干脆咱们不要进行流血战争了，咱们搞个兵棋推演怎么样？于是，各个国家都表明自己所拥有的资源以换取对应的兵棋，最后采用这种文雅的方式决定最后的赢家，整个过程大家都没有付出真的资源进行战争。

这个例子只是形象的解释了POS的设计理念，至于具体的设计细节接下来我会慢慢跟大家解释清楚。

## 2. 应用POS的几个区块链

基于POS共识机制的区块链有多种，每一种设计细节都有细微差别。

### 2.1. 点点币(Peercoin)

2012年8月22日发布的点点币应用了币龄（coin age）这个概念。那么什么是币龄呢？币龄，顾名思义就是数字货币的年龄，计算方式为：币龄=币数量*拥有的币的时间。例如，Alice给Bob转账了10个币，而Bob拿着这个币有2个月，期间没有将之用掉。那么就可以说Bob已经累计了20币月，或者600币天。这个概念早在2010年就被提出来了，当时主要用来决定交易打包入块的顺序，一个用户如果使用较老的的UTXO，那么他的币龄应该很大，交易入块的速度就应该很快。但是目前来说没有矿工愿意遵守这个原则了。一个大币龄的交易如果手续费给的不够，那么照样得排队很久才能确认。

### 2.2. 未来币(NXT)

未来币采用的方式是随机选择若干个节点，根据节点拥有币的比例完成。

## 3. POS的问题

因为POS在打包区块的过程中不需要消耗大量的能源进行挖矿，拥有较多数字货币的记账节点可以同时在多个链条上进行打包而几乎不需要付出任何成本，这就是“nothing-at-stake”。因此，相较于POW链，POS似乎更容易发生双花问题。针对这个问题，各个采用POS的区块链采用了不同的措施来解决这个问题。


## 4. POS的解决方式

- 以太坊上线时运用的共识机制是POW，采用的挖矿算法叫Ethash，之后为了解决这个问题就提出了一种新的POS协议，这就是Casper。
- 点点币（Peercoin）早期阶段需要开发者使用自己的私钥签署一个检查点，在规定的检查点之前严禁分叉。2017年11月1日发布的版本v0.6.0允许用户选择退出检查点。
- 未来币(NXT）设定只允许在最新的720个区块进行分叉。但是攻击者仍然可以对721个区块进行分叉。
- Decredc采用的是混合挖矿模式，即采用POW+POS双共识机制，POS作为第二个验证人。


## 5. 总结

相比于POW，POS不用消耗大量的能源进行毫无意义的数学运算。


## 6. 参考资料

- [Proof-of-stake](https://en.wikipedia.org/wiki/Proof-of-stake)：维基百科中关于POS的介绍。
- [What exactly is the Nothing-At-Stake problem?](https://ethereum.stackexchange.com/questions/2402/what-exactly-is-the-nothing-at-stake-problem)：介绍了nothing-at-stake的概念。
- [PPCoin: Peer-to-Peer Crypto-Currency with Proof-of-Stake](https://peercoin.net/assets/paper/peercoin-paper.pdf)：点点币英文白皮书。
- [PPC:一种P2P（点对点）的权益证明(Proof of Stake)密码学货币（修订版）](https://peercoin.net/assets/paper/peercoin-paper-cn.pdf)：点点币中文白皮书。
